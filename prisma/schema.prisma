generator client {
    provider = "prisma-client-js"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Door {
    id              String  @id @default(cuid())
    name            String
    description     String?
    size            String
    opening         Opening
    color           String
    innerPanelColor String
    count           Int     @default(0)
    clouseBox       Boolean @default(false)
    inner           String?
    porog           Boolean @default(false)
    protivosem      Boolean @default(true)
    sizesDoor       String?
    uplotnitel      String?
    vneshPanel      String?
    zamki           String?

    @@map("Двери")
}

model BetweenDoor {
    id           String  @id @default(cuid())
    name         String
    factory      String?
    is600        Int     @default(0)
    is700        Int     @default(0)
    is800        Int     @default(0)
    is900        Int     @default(0)
    analog       String?
    colors       String?
    innerFilling String?
    comment      String?
    fotoUrl      String?
    materials    String?
}

model Color {
    id   String  @id @default(cuid())
    name String
    url  String?
}

model Record {
    id          String   @id @default(cuid())
    title       String
    description String?
    quantity    Int      @default(0)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    @@map("Records")
}

model Price {
    id    String @id @default(cuid())
    name  String
    price String
}

model User {
    id        String   @id @default(cuid())
    name      String
    email     String   @unique
    phone     String?
    password  String
    role      Role     @default(USER)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    nickName  String?

    @@index([role])
    @@index([email, role])
}

model OrderInStock {
    id               String             @id @default(cuid())
    shortDescription String?
    fullDescription  String?
    numberOrder      String
    completed        Boolean            @default(false)
    url              String[]           @default([])
    statusInStock    StatusOrderInStock @default(ORDERED)
}

model OrderBN {
    id          String  @id @default(cuid())
    name        String
    orderNumber String?
    in1C        Boolean @default(false)
}

model verifyCode {
    id           String    @id @default(cuid())
    email        String
    code         String
    createdAt    DateTime  @default(now())
    attempts     Int       @default(0)
    blockedUntil DateTime?
    expiresAt    DateTime
    used         Boolean   @default(false)

    @@index([email, createdAt])
    @@index([expiresAt])
    @@index([used])
    @@index([blockedUntil])
    @@index([email, expiresAt, used])
}

model IpRateLimit {
    id             String   @id @default(cuid())
    ip             String
    action         String
    count          Int      @default(1)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
    manual_locking Boolean  @default(false)
    client_name    String   @default("Не известный")

    @@unique([ip, action], name: "ip_action")
    @@index([ip, action, createdAt], map: "ip_action_time")
    @@index([createdAt], map: "created_at_idx")
    @@index([manual_locking])
}

enum Opening {
    LEFT
    RIGHT
}

enum Role {
    GOOD
    USER
}

enum StatusOrderInStock {
    ORDERED
    IN_STOCK
    DELIVERY_PROCESS
    DELIVERED
}
